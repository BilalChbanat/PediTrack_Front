# Local Document Storage

This folder contains locally stored documents generated by the PediTrack application.

## File Naming Convention

Documents are saved with the following naming pattern:
```
{patientId}_{date}_{timestamp}_{sanitizedTitle}.{extension}
```

### Example:
```
patient123_2024-01-15_1705312345678_Consultation_Medicale.txt
```

### Components:
- **patientId**: The unique identifier of the patient
- **date**: Date in YYYY-MM-DD format
- **timestamp**: Unix timestamp for uniqueness
- **sanitizedTitle**: Document title with special characters removed
- **extension**: File extension based on document type (.txt, .pdf, .docx, .jpg, etc.)

## Document Types

### Supported File Types:
- **Word Templates**: Saved as `.txt` files
- **PDF Documents**: Saved as `.pdf` files  
- **Word Documents**: Saved as `.docx` files
- **Images**: Saved as `.jpg`, `.png`, `.gif` files
- **Text Files**: Saved as `.txt` files
- **General Documents**: Saved with original extension

### Upload Sources:
1. **Word Template Creation**: Rich text editor with formatting
2. **File Upload**: Direct file upload from user's device
3. **Document Generation**: System-generated documents

## Storage Location

Documents are stored in two places:
1. **Local File System**: `src/data/documents/` (for development)
2. **Browser localStorage**: As a fallback for web applications

## File Structure

```
src/data/documents/
├── .gitkeep          # Ensures folder is tracked by git
├── README.md         # This documentation
└── {patientId}_{timestamp}_{title}.{ext}  # Document files
```

## Upload Process

### 1. File Upload Flow:
1. User selects file from device
2. File is read and processed locally
3. Content is saved to localStorage
4. File is named with patient ID and timestamp
5. Server upload is attempted (if available)
6. Success message shows local file path

### 2. Word Template Flow:
1. User creates document in rich text editor
2. Content is formatted and previewed
3. Document is saved locally with proper naming
4. Export options available (PDF, DOCX, TXT)
5. Document appears in patient's history

## File Processing

### Text Files:
- Read as plain text
- Stored as UTF-8 encoded content
- Preserved formatting and structure

### Binary Files (PDF, Images, etc.):
- Converted to base64 for storage
- Preserved original file format
- Proper MIME type detection

### File Type Detection:
- Automatic extension-based type detection
- Proper MIME type assignment
- Fallback to generic document type

## Accessing Documents

Documents can be accessed through:
- The PediTrack application interface
- Direct file system access (development)
- Browser localStorage (web application)
- Download functionality for all file types

## Backup and Sync

- Documents are automatically backed up to localStorage
- Server sync is attempted when available
- Local documents persist between sessions
- Offline functionality when server is unavailable

## Error Handling

### Upload Failures:
- Server errors don't prevent local storage
- Graceful fallback to local-only storage
- Clear error messages to users
- Automatic retry mechanisms

### File Processing:
- Validation of file types and sizes
- Error recovery for corrupted files
- Fallback handling for unsupported formats

## Performance

### Optimization:
- Lazy loading of document content
- Efficient localStorage management
- Minimal memory footprint
- Fast file type detection

### Storage Limits:
- Browser localStorage limits respected
- Automatic cleanup of old documents
- Efficient data compression where possible 